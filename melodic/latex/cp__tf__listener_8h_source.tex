\hypertarget{cp__tf__listener_8h_source}{}\doxysection{cp\+\_\+tf\+\_\+listener.\+h}
\label{cp__tf__listener_8h_source}\index{smacc\_client\_library/move\_group\_interface\_client/include/move\_group\_interface\_client/components/cp\_tf\_listener.h@{smacc\_client\_library/move\_group\_interface\_client/include/move\_group\_interface\_client/components/cp\_tf\_listener.h}}
\mbox{\hyperlink{cp__tf__listener_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00001}00001 \textcolor{comment}{/*****************************************************************************************************************}}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00002}00002 \textcolor{comment}{ * ReelRobotix Inc. -\/ Software License Agreement      Copyright (c) 2018-\/2020}}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00003}00003 \textcolor{comment}{ *   Authors: Pablo Inigo Blasco, Brett Aldrich}}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00004}00004 \textcolor{comment}{ *}}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00005}00005 \textcolor{comment}{ ******************************************************************************************************************/}}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00006}00006 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00007}00007 }
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00008}00008 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{component_8h}{smacc/component.h}}>}}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00009}00009 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{smacc__updatable_8h}{smacc/smacc\_updatable.h}}>}}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00010}00010 }
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00011}00011 \textcolor{preprocessor}{\#include <geometry\_msgs/Pose.h>}}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00012}00012 \textcolor{preprocessor}{\#include <tf/transform\_listener.h>}}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00013}00013 \textcolor{preprocessor}{\#include <tf/transform\_datatypes.h>}}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00014}00014 \textcolor{preprocessor}{\#include <mutex>}}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00015}00015 \textcolor{preprocessor}{\#include <thread>}}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00016}00016 }
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00017}00017 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespacecl__move__base__z}{cl\_move\_base\_z}}}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00018}00018 \{}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00019}\mbox{\hyperlink{structcl__move__base__z_1_1TfPoseTrack}{00019}}     \textcolor{keyword}{struct }\mbox{\hyperlink{structcl__move__base__z_1_1TfPoseTrack}{TfPoseTrack}}}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00020}00020     \{}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00021}\mbox{\hyperlink{structcl__move__base__z_1_1TfPoseTrack_adcc7f5b2efe012138fcaa78b4cb9a171}{00021}}         std::mutex \mbox{\hyperlink{structcl__move__base__z_1_1TfPoseTrack_adcc7f5b2efe012138fcaa78b4cb9a171}{mutex\_}};}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00022}\mbox{\hyperlink{structcl__move__base__z_1_1TfPoseTrack_a4ec7517f9a2d808642eaf9fb0ea88808}{00022}}         geometry\_msgs::PoseStamped \mbox{\hyperlink{structcl__move__base__z_1_1TfPoseTrack_a4ec7517f9a2d808642eaf9fb0ea88808}{pose\_}};}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00023}\mbox{\hyperlink{structcl__move__base__z_1_1TfPoseTrack_a02910828a8320e62cda39c6453ad44ff}{00023}}         std::string \mbox{\hyperlink{structcl__move__base__z_1_1TfPoseTrack_a02910828a8320e62cda39c6453ad44ff}{targetPoseFrame\_}};}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00024}\mbox{\hyperlink{structcl__move__base__z_1_1TfPoseTrack_a3042763af6b267cbab9ba0bf2aa1f783}{00024}}         std::string \mbox{\hyperlink{structcl__move__base__z_1_1TfPoseTrack_a3042763af6b267cbab9ba0bf2aa1f783}{referenceBaseFrame\_}};}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00025}\mbox{\hyperlink{structcl__move__base__z_1_1TfPoseTrack_a951e6561b20a681a868ec84f916be436}{00025}}         \textcolor{keywordtype}{bool} \mbox{\hyperlink{structcl__move__base__z_1_1TfPoseTrack_a951e6561b20a681a868ec84f916be436}{once}} = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00026}\mbox{\hyperlink{structcl__move__base__z_1_1TfPoseTrack_a7af0502b3fb73556c387fa04ff8a1d9a}{00026}}         \textcolor{keywordtype}{bool} \mbox{\hyperlink{structcl__move__base__z_1_1TfPoseTrack_a7af0502b3fb73556c387fa04ff8a1d9a}{isInitialized}} = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00027}00027     \};}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00028}00028 }
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00029}\mbox{\hyperlink{classcl__move__base__z_1_1CpTFListener}{00029}}     \textcolor{keyword}{class }\mbox{\hyperlink{classcl__move__base__z_1_1CpTFListener}{CpTFListener}} : \textcolor{keyword}{public} \mbox{\hyperlink{classsmacc_1_1ISmaccComponent}{smacc::ISmaccComponent}}, \textcolor{keyword}{public} \mbox{\hyperlink{classsmacc_1_1ISmaccUpdatable}{smacc::ISmaccUpdatable}}}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00030}00030     \{}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00031}00031     \textcolor{keyword}{public}:}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00032}\mbox{\hyperlink{classcl__move__base__z_1_1CpTFListener_a4379d3a0b3d67ffbb0741688bf39dda5}{00032}}         \mbox{\hyperlink{classcl__move__base__z_1_1CpTFListener_a4379d3a0b3d67ffbb0741688bf39dda5}{CpTFListener}}();}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00033}00033 }
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00034}\mbox{\hyperlink{classcl__move__base__z_1_1CpTFListener_a0bdf03c329aab2ea038b67e51996a515}{00034}}         \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} \mbox{\hyperlink{classcl__move__base__z_1_1CpTFListener_a0bdf03c329aab2ea038b67e51996a515}{update}}()\textcolor{keyword}{ override}}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00035}00035 \textcolor{keyword}{        }\{}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00036}00036             \textcolor{keywordflow}{for}(\textcolor{keyword}{auto}\& poseTrack: \mbox{\hyperlink{classcl__move__base__z_1_1CpTFListener_a22555065516af0d20ea11d72dc4daa9b}{poseTracks\_}})}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00037}00037             \{}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00038}00038                 tf::StampedTransform transform;}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00039}00039                 \textcolor{keywordflow}{try}}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00040}00040                 \{}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00041}00041                     \{}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00042}00042                         std::lock\_guard<std::mutex> lock(\mbox{\hyperlink{classcl__move__base__z_1_1CpTFListener_aaf49a2f8524426920ae22fbc692a853d}{listenerMutex\_}});}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00043}00043                         \mbox{\hyperlink{classcl__move__base__z_1_1CpTFListener_a9a01782f5bd1ef2751b8044b2b5b3285}{tfListener\_}}-\/>lookupTransform(poseTrack-\/>referenceBaseFrame\_,poseTrack-\/>targetPoseFrame\_,}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00044}00044                                                     ros::Time(0), transform);}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00045}00045                     \}}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00046}00046 }
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00047}00047                     \{}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00048}00048                         std::lock\_guard<std::mutex> guard(\mbox{\hyperlink{classcl__move__base__z_1_1CpTFListener_adf87e22c71f56e64622e7046bcf68ffe}{m\_mutex\_}});}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00049}00049                         tf::poseTFToMsg(transform, poseTrack-\/>pose\_.pose);}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00050}00050                         poseTrack-\/>pose\_.header.stamp = transform.stamp\_;}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00051}00051                         poseTrack-\/>pose\_.header.frame\_id = poseTrack-\/>referenceBaseFrame\_;}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00052}00052                         poseTrack-\/>isInitialized = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00053}00053                     \}}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00054}00054                 \}}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00055}00055                 \textcolor{keywordflow}{catch} (tf::TransformException ex)}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00056}00056                 \{}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00057}00057                     ROS\_ERROR\_STREAM\_THROTTLE(1, \textcolor{stringliteral}{"{}[Component pose] ("{}} << poseFrameName\_ << \textcolor{stringliteral}{"{}/["{}} << referenceFrame\_ << \textcolor{stringliteral}{"{}] ) is failing on pose update : "{}} << ex.what());}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00058}00058                 \}}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00059}00059             \}}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00060}00060         \}}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00061}00061 }
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00062}\mbox{\hyperlink{classcl__move__base__z_1_1CpTFListener_aad004e766d7a922129bd4b0b6320ea47}{00062}}         \textcolor{keywordtype}{void} \mbox{\hyperlink{classcl__move__base__z_1_1CpTFListener_aad004e766d7a922129bd4b0b6320ea47}{getLastTransform}}(std::string \&targetPoseFrameName, std::string \&referenceBaseFrame, geometry\_msgs::Pose \&out)}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00063}00063         \{}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00064}00064         \}}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00065}00065 }
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00066}\mbox{\hyperlink{classcl__move__base__z_1_1CpTFListener_a7aac538345fefd72ed4e59abd0f52d32}{00066}}         std::future<geometry\_msgs::Pose> \mbox{\hyperlink{classcl__move__base__z_1_1CpTFListener_a7aac538345fefd72ed4e59abd0f52d32}{waitForNextTransform}}(std::string \&targetName, std::string \&referenceBaseFrame)}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00067}00067         \{}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00068}00068             tracks\_}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00069}00069         \}}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00070}00070 }
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00071}00071     \textcolor{keyword}{private}:}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00072}\mbox{\hyperlink{classcl__move__base__z_1_1CpTFListener_a9a01782f5bd1ef2751b8044b2b5b3285}{00072}}         \textcolor{keyword}{static} std::shared\_ptr<tf::TransformListener> \mbox{\hyperlink{classcl__move__base__z_1_1CpTFListener_a9a01782f5bd1ef2751b8044b2b5b3285}{tfListener\_}};}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00073}\mbox{\hyperlink{classcl__move__base__z_1_1CpTFListener_aaf49a2f8524426920ae22fbc692a853d}{00073}}         \textcolor{keyword}{static} std::mutex \mbox{\hyperlink{classcl__move__base__z_1_1CpTFListener_aaf49a2f8524426920ae22fbc692a853d}{listenerMutex\_}};}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00074}00074 }
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00075}\mbox{\hyperlink{classcl__move__base__z_1_1CpTFListener_adf87e22c71f56e64622e7046bcf68ffe}{00075}}         std::mutex \mbox{\hyperlink{classcl__move__base__z_1_1CpTFListener_adf87e22c71f56e64622e7046bcf68ffe}{m\_mutex\_}};}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00076}\mbox{\hyperlink{classcl__move__base__z_1_1CpTFListener_a22555065516af0d20ea11d72dc4daa9b}{00076}}         std::list<std::shared\_ptr<TfPoseTrack>> \mbox{\hyperlink{classcl__move__base__z_1_1CpTFListener_a22555065516af0d20ea11d72dc4daa9b}{poseTracks\_}};}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00077}00077     \};}
\DoxyCodeLine{\Hypertarget{cp__tf__listener_8h_source_l00078}00078 \} \textcolor{comment}{// namespace cl\_move\_base\_z}}

\end{DoxyCode}
